<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My 2 Bus Lines</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    </head>
<body>

    <div class="card">
        <h2>My 2 Bus Lines</h2>
    </div>

    <div class="select-row" style="display:flex;gap:5em;justify-content:center;flex-wrap:wrap;margin:1.2em 0;">
        <div style="min-width:300px;">
            <label for="line1"><strong>Line 1</strong></label>
            <select id="line1" name="line1" style="width:100%;padding:0.8em;border-radius:0.5em;">
                <option value="">Select line</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>005/006</option>
                <option>7</option>
                <option>8</option>
                <option>9</option>
                <option>10</option>
                <option>14</option>
                <option>015/050</option>
                <option>16</option>
                <option>17</option>
                <option>19</option>
                <option>20</option>
                <option>22</option>
                <option>23</option>
                <option>25</option>
                <option>26</option>
                <option>27</option>
                <option>28</option>
                <option>29</option>
                <option>31</option>
                <option>33</option>
                <option>41</option>
                <option>42</option>
                <option>44</option>
                <option>49</option>
                <option>68</option>
                <option>80</option>
                <option>84</option>
                <option>99</option>
                <option>100</option>
                <option>101</option>
                <option>102/103</option>
                <option>104</option>
                <option>105</option>
                <option>106</option>
                <option>109</option>
                <option>110</option>
                <option>112</option>
                <option>116</option>
                <option>119</option>
                <option>123</option>
                <option>128</option>
                <option>129/133</option>
                <option>130</option>
                <option>131</option>
                <option>132</option>
                <option>134</option>
                <option>136</option>
                <option>143</option>
                <option>144</option>
                <option>145</option>
                <option>146</option>
                <option>147</option>
                <option>148</option>
                <option>151</option>
                <option>152</option>
                <option>153</option>
                <option>155</option>
                <option>156</option>
                <option>157</option>
                <option>159</option>
                <option>160</option>
                <option>169</option>
                <option>170</option>
                <option>171/172</option>
                <option>173/174</option>
                <option>175</option>
                <option>179</option>
                <option>180</option>
                <option>181</option>
                <option>182</option>
                <option>183</option>
                <option>184/185</option>
                <option>186</option>
                <option>187</option>
                <option>188</option>
                <option>189</option>
                <option>191</option>
                <option>209</option>
                <option>210</option>
                <option>211</option>
                <option>212</option>
                <option>215</option>
                <option>222</option>
                <option>227</option>
                <option>228</option>
                <option>229</option>
                <option>230</option>
                <option>231</option>
                <option>232</option>
                <option>236</option>
                <option>240</option>
                <option>241</option>
                <option>245</option>
                <option>246/249</option>
                <option>247</option>
                <option>250</option>
                <option>251</option>
                <option>252</option>
                <option>253</option>
                <option>254</option>
                <option>255</option>
                <option>256</option>
                <option>257</option>
                <option>262</option>
                <option>301</option>
                <option>310</option>
                <option>311</option>
                <option>312</option>
                <option>314</option>
                <option>316</option>
                <option>319</option>
                <option>320</option>
                <option>321</option>
                <option>322</option>
                <option>323</option>
                <option>324</option>
                <option>325</option>
                <option>326</option>
                <option>329</option>
                <option>335</option>
                <option>337</option>
                <option>340</option>
                <option>341</option>
                <option>342</option>
                <option>345</option>
                <option>350</option>
                <option>351</option>
                <option>352</option>
                <option>354</option>
                <option>360</option>
                <option>361</option>
                <option>362</option>
                <option>363</option>
                <option>364</option>
                <option>371</option>
                <option>373</option>
                <option>375</option>
                <option>388</option>
                <option>391</option>
                <option>393</option>
                <option>394</option>
                <option>395</option>
                <option>401</option>
                <option>402</option>
                <option>403</option>
                <option>404</option>
                <option>405</option>
                <option>406</option>
                <option>407</option>
                <option>408</option>
                <option>410</option>
                <option>412</option>
                <option>413</option>
                <option>414</option>
                <option>416</option>
                <option>418</option>
                <option>430</option>
                <option>501</option>
                <option>502</option>
                <option>503</option>
                <option>509</option>
                <option>531</option>
                <option>555</option>
                <option>595</option>
                <option>601</option>
                <option>602</option>
                <option>603</option>
                <option>604</option>
                <option>609</option>
                <option>614</option>
                <option>616</option>
                <option>618</option>
                <option>619</option>
                <option>620</option>
                <option>640</option>
                <option>701</option>
                <option>719/722</option>
                <option>733</option>
                <option>741</option>
                <option>743</option>
                <option>744</option>
                <option>745/746</option>
                <option>748</option>
                <option>749</option>
                <option>791</option>
                <option>894</option>
                <option>R1</option>
                <option>R2</option>
                <option>R3</option>
                <option>R4</option>
                <option>R5</option>
                <option>R6</option>
            </select>
        </div>

        <div style="display:flex;align-items:center;justify-content:center;min-width:70px;">
            <button id="swapBtn" aria-label="Swap lines" title="Swap lines" style="height:40px;width:40px;border-radius:20px;border:none;background:#006c9e;color:#fff;font-size:18px;cursor:pointer;margin:0 8px;">â‡„</button>
        </div>

        <div style="min-width:300px;">
            <label for="line2"><strong>Line 2</strong></label>
            <select id="line2" name="line2" style="width:100%;padding:0.8em;border-radius:0.5em;">
                <option value="">Select line</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>005/006</option>
                <option>7</option>
                <option>8</option>
                <option>9</option>
                <option>10</option>
                <option>14</option>
                <option>015/050</option>
                <option>16</option>
                <option>17</option>
                <option>19</option>
                <option>20</option>
                <option>22</option>
                <option>23</option>
                <option>25</option>
                <option>26</option>
                <option>27</option>
                <option>28</option>
                <option>29</option>
                <option>31</option>
                <option>33</option>
                <option>41</option>
                <option>42</option>
                <option>44</option>
                <option>49</option>
                <option>68</option>
                <option>80</option>
                <option>84</option>
                <option>99</option>
                <option>100</option>
                <option>101</option>
                <option>102/103</option>
                <option>104</option>
                <option>105</option>
                <option>106</option>
                <option>109</option>
                <option>110</option>
                <option>112</option>
                <option>116</option>
                <option>119</option>
                <option>123</option>
                <option>128</option>
                <option>129/133</option>
                <option>130</option>
                <option>131</option>
                <option>132</option>
                <option>134</option>
                <option>136</option>
                <option>143</option>
                <option>144</option>
                <option>145</option>
                <option>146</option>
                <option>147</option>
                <option>148</option>
                <option>151</option>
                <option>152</option>
                <option>153</option>
                <option>155</option>
                <option>156</option>
                <option>157</option>
                <option>159</option>
                <option>160</option>
                <option>169</option>
                <option>170</option>
                <option>171/172</option>
                <option>173/174</option>
                <option>175</option>
                <option>179</option>
                <option>180</option>
                <option>181</option>
                <option>182</option>
                <option>183</option>
                <option>184/185</option>
                <option>186</option>
                <option>187</option>
                <option>188</option>
                <option>189</option>
                <option>191</option>
                <option>209</option>
                <option>210</option>
                <option>211</option>
                <option>212</option>
                <option>215</option>
                <option>222</option>
                <option>227</option>
                <option>228</option>
                <option>229</option>
                <option>230</option>
                <option>231</option>
                <option>232</option>
                <option>236</option>
                <option>240</option>
                <option>241</option>
                <option>245</option>
                <option>246/249</option>
                <option>247</option>
                <option>250</option>
                <option>251</option>
                <option>252</option>
                <option>253</option>
                <option>254</option>
                <option>255</option>
                <option>256</option>
                <option>257</option>
                <option>262</option>
                <option>301</option>
                <option>310</option>
                <option>311</option>
                <option>312</option>
                <option>314</option>
                <option>316</option>
                <option>319</option>
                <option>320</option>
                <option>321</option>
                <option>322</option>
                <option>323</option>
                <option>324</option>
                <option>325</option>
                <option>326</option>
                <option>329</option>
                <option>335</option>
                <option>337</option>
                <option>340</option>
                <option>341</option>
                <option>342</option>
                <option>345</option>
                <option>350</option>
                <option>351</option>
                <option>352</option>
                <option>354</option>
                <option>360</option>
                <option>361</option>
                <option>362</option>
                <option>363</option>
                <option>364</option>
                <option>371</option>
                <option>373</option>
                <option>375</option>
                <option>388</option>
                <option>391</option>
                <option>393</option>
                <option>394</option>
                <option>395</option>
                <option>401</option>
                <option>402</option>
                <option>403</option>
                <option>404</option>
                <option>405</option>
                <option>406</option>
                <option>407</option>
                <option>408</option>
                <option>410</option>
                <option>412</option>
                <option>413</option>
                <option>414</option>
                <option>416</option>
                <option>418</option>
                <option>430</option>
                <option>501</option>
                <option>502</option>
                <option>503</option>
                <option>509</option>
                <option>531</option>
                <option>555</option>
                <option>595</option>
                <option>601</option>
                <option>602</option>
                <option>603</option>
                <option>604</option>
                <option>609</option>
                <option>614</option>
                <option>616</option>
                <option>618</option>
                <option>619</option>
                <option>620</option>
                <option>640</option>
                <option>701</option>
                <option>719/722</option>
                <option>733</option>
                <option>741</option>
                <option>743</option>
                <option>744</option>
                <option>745/746</option>
                <option>748</option>
                <option>749</option>
                <option>791</option>
                <option>894</option>
                <option>R1</option>
                <option>R2</option>
                <option>R3</option>
                <option>R4</option>
                <option>R5</option>
                <option>R6</option>
            </select>
        </div>
    </div>

    

    <div style="display:flex;flex-direction:column;align-items:center;margin-top:1em;gap:0.5em;">
        <div style="width:260px;text-align:center;">
            <button id="compareBtn" class="button-card-2" style="width:100%;">Compare</button>
        </div>
        <div id="compareResult" class="vs-compare" style="text-align:center;margin-top:0.5em;font-weight:bold;color:#006c9e;word-wrap:break-word;"></div>
    </div>

    <script>
        let boardingsData = {};
        let dailyBoardingsData = {};
        let hoursData = {};
        let currentDailyType = 'weekday'; // Track the current daily type selected
        let currentHoursType = 'revenue'; // Track the current hours type selected
        let currentLineA = ''; // Track the current line A
        let currentLineB = ''; // Track the current line B
        let dataLoaded = false;

        // Load 2024 Annual Boardings data from API on page load
        fetch('/api/boardings-data')
            .then(response => {
                if (!response.ok) throw new Error('Failed to load boardings data');
                return response.json();
            })
            .then(data => {
                boardingsData = data;
                console.log('Boardings data loaded successfully');
            })
            .catch(error => console.error('Error loading boardings data:', error));

        // Load daily boardings data from API on page load
        fetch('/api/daily-boardings-data')
            .then(response => {
                if (!response.ok) throw new Error('Failed to load daily boardings data');
                return response.json();
            })
            .then(data => {
                dailyBoardingsData = data;
                dataLoaded = true;
                console.log('Daily boardings data loaded successfully');
            })
            .catch(error => console.error('Error loading daily boardings data:', error));

        // Load hours data from API on page load
        fetch('/api/hours-data')
            .then(response => {
                if (!response.ok) throw new Error('Failed to load hours data');
                return response.json();
            })
            .then(data => {
                hoursData = data;
                console.log('Hours data loaded successfully');
            })
            .catch(error => console.error('Error loading hours data:', error));

        function formatNumber(num) {
            return Math.round(num).toLocaleString();
        }

        function escapeHtml(str) {
            return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        function generatePeopleIcons(boardings) {
            // Round to nearest 50,000
            const rounded = Math.round(boardings / 50000) * 50000;
            // 1 full person = 100,000 boardings
            const peopleUnits = rounded / 100000;
            const fullPeople = Math.floor(peopleUnits);
            const hasHalfPerson = (peopleUnits % 1) !== 0;

            let html = '<div style="margin: 30px 0; font-size: 1.2em; line-height: 2.2;">';
            let count = 0;

            // Create rows of 10 people
            for (let i = 0; i < fullPeople; i++) {
                if (count === 10) {
                    html += '<br>';
                    count = 0;
                }
                html += '<img src="/static/icons/person symbol.png" alt="person" style="height: 80px; width: 40px; display: inline-block; margin: 2px;">';
                count++;
            }

            // Add half person if needed
            if (hasHalfPerson) {
                if (count === 10) {
                    html += '<br>';
                    count = 0;
                }
                html += '<img src="/static/icons/half person figure.png" alt="half person" style="height: 80px; width: 20px; display: inline-block; margin: 2px;">';
            }

            html += '</div>';
            html += '<div style="font-size: 1em; color: rgba(255,255,255,0.8); margin-top: 6px; letter-spacing: 0.5px; display:flex;gap:12px;align-items:center;justify-content:center;">' +
                        '<img src="/static/icons/person symbol.png" alt="person" style="height:35px;width:auto;display:inline-block;">' +
                        '<span>= 100,000 boardings</span>' +
                    '</div>';

            return html;
        }

        function generatePeopleIconsDaily(boardings) {
            // Round to nearest 500
            const rounded = Math.round(boardings / 500) * 500;
            // 1 full person = 1,000 boardings
            const peopleUnits = rounded / 1000;
            const fullPeople = Math.floor(peopleUnits);
            const hasHalfPerson = (peopleUnits % 1) !== 0;

            let html = '<div style="margin: 30px 0; font-size: 1.2em; line-height: 2.2;">';
            let count = 0;

            // Create rows of 10 people
            for (let i = 0; i < fullPeople; i++) {
                if (count === 10) {
                    html += '<br>';
                    count = 0;
                }
                html += '<img src="/static/icons/person symbol.png" alt="person" style="height: 80px; width: 40px; display: inline-block; margin: 2px;">';
                count++;
            }

            // Add half person if needed
            if (hasHalfPerson) {
                if (count === 10) {
                    html += '<br>';
                    count = 0;
                }
                html += '<img src="/static/icons/half person figure.png" alt="half person" style="height: 80px; width: 20px; display: inline-block; margin: 2px;">';
            }

            html += '</div>';
            html += '<div style="font-size: 1em; color: rgba(255,255,255,0.8); margin-top: 6px; letter-spacing: 0.5px; display:flex;gap:12px;align-items:center;justify-content:center;">' +
                        '<img src="/static/icons/person symbol.png" alt="person" style="height:35px;width:auto;display:inline-block;">' +
                        '<span>= 1,000 boardings</span>' +
                    '</div>';

            return html;
        }

        function generateSquareIcons(hours) {
            // Round to nearest 500
            const rounded = Math.round(hours / 500) * 500;
            // 1 full square = 1,000 hours
            const squareUnits = rounded / 1000;
            const fullSquares = Math.floor(squareUnits);
            const hasHalfSquare = (squareUnits % 1) !== 0;

            let html = '<div style="margin: 30px 0; font-size: 1.2em; line-height: 2.2;">';
            let count = 0;

            // Create rows of 10 squares
            for (let i = 0; i < fullSquares; i++) {
                if (count === 10) {
                    html += '<br>';
                    count = 0;
                }
                // Full square: 20x20 pixels
                html += '<img src="/static/icons/full square.png" alt="person" style="height: 40px; width: 40px; display: inline-block; margin: 2px;">';
                count++;
            }

            // Add half square if needed
            if (hasHalfSquare) {
                if (count === 10) {
                    html += '<br>';
                    count = 0;
                }
                // Half square: 10x20 pixels
                html += '<img src="/static/icons/half square.png" alt="half person" style="height: 40px; width: 20px; display: inline-block; margin: 2px;">';
            }

            html += '</div>';
            html += '<div style="font-size: 1em; color: rgba(255,255,255,0.8); margin-top: 6px; letter-spacing: 0.5px; display:flex;gap:12px;align-items:center;justify-content:center;">' +
                        '<img src="/static/icons/full square.png" alt="person" style="height:35px;width:auto;display:inline-block;">'  +
                        '<span>= 1,000 hours</span>' +
                    '</div>';

            return html;
        }

        function formatSig(n) {
            // format number to 3 significant figures and remove trailing zeros where reasonable
            if (n === 0) return '0';
            const s = Number(n).toPrecision(3);
            // remove unnecessary trailing zeros and possible trailing dot
            return parseFloat(s).toString();
        }

        document.getElementById('compareBtn').addEventListener('click', function () {
            var a = document.getElementById('line1').value || 'X';
            var b = document.getElementById('line2').value || 'Y';
            a = escapeHtml(a);
            b = escapeHtml(b);
            
            // Store the current line selections for use by daily button handlers
            currentLineA = a;
            currentLineB = b;
            currentDailyType = 'weekday';

            // Get boardings data with people visualization
            var boardingsAHtml = '';
            var boardingsBHtml = '';

            if (boardingsData[a]) {
                boardingsAHtml = generatePeopleIcons(boardingsData[a]) +
                    '<div style="margin-top: 12px; font-size: 34px; font-weight: 800; color: #fff;">' + formatNumber(boardingsData[a]) + '<br><span style="font-size:0.75em; font-weight:600;">Boardings</span></div>';
            } else {
                boardingsAHtml = 'Please select bus line';
            }

            if (boardingsData[b]) {
                boardingsBHtml = generatePeopleIcons(boardingsData[b]) +
                    '<div style="margin-top: 12px; font-size: 34px; font-weight: 800; color: #fff;">' + formatNumber(boardingsData[b]) + '<br><span style="font-size:0.75em; font-weight:600;">Boardings</span></div>';
            } else {
                boardingsBHtml = 'Please select bus line';
            }

            // build comparison text
            var comparisonText = '';
            if (boardingsData[a] && boardingsData[b]) {
                var leftVal = Number(boardingsData[a]);
                var rightVal = Number(boardingsData[b]);
                if (leftVal === rightVal) {
                    comparisonText = a + ' and ' + b + ' have equal annual boardings';
                } else if (leftVal > rightVal) {
                    var ratio = leftVal / rightVal;
                    if (ratio > 2) {
                        comparisonText = a + ' has ' + formatSig(ratio) + 'x more annual boardings than ' + b;
                    } else {
                        var pct = (leftVal - rightVal) / rightVal * 100;
                        comparisonText = a + ' has ' + formatSig(pct) + '% more annual\nboardings than ' + b;
                    }
                } else {
                    var pct = (rightVal - leftVal) / rightVal * 100;
                    comparisonText = a + ' has ' + formatSig(pct) + '% less annual\nboardings than ' + b;
                }
            }

            var html = '<div class="vs-container">' +
                '<div class="half left">' + a +
                    '<div class="stats-box">' + boardingsAHtml + '</div>' +
                '</div>' +
                '<div class="half right">' + b +
                    '<div class="stats-box">' + boardingsBHtml + '</div>' +
                '</div>' +
                '<div class="vs-badge">VS</div>' +
                '<div class="divider-line"></div>' +
                '<div class="annual-boardings-badge">Annual Boardings</div>' +
                (comparisonText ? '<div class="comparison-badge">' + comparisonText + '</div>' : '') +
                '</div>' +

                // Daily boardings selection buttons
                '<div class="daily-boardings-selectors">' +
                    '<button type="button" class="daily-btn daily-btn-active" id="btn-daily-weekday">Weekday</button>' +
                    '<button type="button" class="daily-btn" id="btn-daily-sat">Sat</button>' +
                    '<button type="button" class="daily-btn" id="btn-daily-sun">Sun/Hol</button>' +
                '</div>' +
                '<div id="daily-boardings-display" class="vs-container">' +

                '</div>' +

                // Revenue/Service hours selection buttons
                '<div class="hours-selectors">' +
                    '<button type="button" class="hours-btn hours-btn-active" id="btn-hours-revenue">Revenue</button>' +
                    '<button type="button" class="hours-btn" id="btn-hours-service">Service</button>' +
                '</div>' +
                '<div id="hours-display" class="vs-container">' +
                '</div>';

            document.getElementById('compareResult').innerHTML = html;
            
            // Update daily boardings display for the default (weekday) selection
            updateDailyBoardingsDisplay(a, b, 'weekday');
            
            // Update hours display for the default (revenue) selection
            updateHoursDisplay(a, b, 'revenue');
        });

        function updateDailyBoardingsDisplay(a, b, dayType) {
            currentDailyType = dayType;
            
            // Get daily boardings data for the selected day type
            var dailyBoardingsAHtml = '';
            var dailyBoardingsBHtml = '';
            var dayName = '';
            var dailyValueA = null;
            var dailyValueB = null;
            
            if (dayType === 'weekday') {
                dayName = 'Weekday';
            } else if (dayType === 'saturday') {
                dayName = 'Saturday';
            } else if (dayType === 'sunday') {
                dayName = 'Sunday/Holiday';
            }
            
            // Check if line a has data
            if (dailyBoardingsData && dailyBoardingsData[a]) {
                var weekdayVal = dailyBoardingsData[a][dayType];
                if (weekdayVal !== undefined && weekdayVal !== null && !isNaN(weekdayVal)) {
                    dailyValueA = weekdayVal;
                    dailyBoardingsAHtml = generatePeopleIconsDaily(dailyValueA) +
                        '<div style="margin-top: 12px; font-size: 34px; font-weight: 800; color: #fff;">' + formatNumber(dailyValueA) + '<br><span style="font-size:0.75em; font-weight:600;">Daily Boardings</span></div>';
                } else {
                    dailyBoardingsAHtml = 'No data for ' + dayName;
                }
            } else {
                dailyBoardingsAHtml = 'No data available for line ' + a;
            }

            // Check if line b has data
            if (dailyBoardingsData && dailyBoardingsData[b]) {
                var weekdayVal = dailyBoardingsData[b][dayType];
                if (weekdayVal !== undefined && weekdayVal !== null && !isNaN(weekdayVal)) {
                    dailyValueB = weekdayVal;
                    dailyBoardingsBHtml = generatePeopleIconsDaily(dailyValueB) +
                        '<div style="margin-top: 12px; font-size: 34px; font-weight: 800; color: #fff;">' + formatNumber(dailyValueB) + '<br><span style="font-size:0.75em; font-weight:600;">Daily Boardings</span></div>';
                } else {
                    dailyBoardingsBHtml = 'No data for ' + dayName;
                }
            } else {
                dailyBoardingsBHtml = 'No data available for line ' + b;
            }

            // Build daily comparison text
            var dailyComparisonText = '';
            if (dailyValueA !== null && dailyValueB !== null) {
                var leftVal = Number(dailyValueA);
                var rightVal = Number(dailyValueB);
                if (leftVal === rightVal) {
                    dailyComparisonText = a + ' and ' + b + ' have equal daily boardings';
                } else if (leftVal > rightVal) {
                    var ratio = leftVal / rightVal;
                    if (ratio > 2) {
                        dailyComparisonText = a + ' has ' + formatSig(ratio) + 'x more daily boardings than ' + b;
                    } else {
                        var pct = (leftVal - rightVal) / rightVal * 100;
                        dailyComparisonText = a + ' has ' + formatSig(pct) + '% more daily\nboardings than ' + b;
                    }
                } else {
                    var pct = (rightVal - leftVal) / rightVal * 100;
                    dailyComparisonText = a + ' has ' + formatSig(pct) + '% less daily\nboardings than ' + b;
                }
            }

            var html = '<div class="half left">' + a +
                '<div class="stats-box">' + dailyBoardingsAHtml + '</div>' +
                '</div>' +
                '<div class="half right">' + b +
                    '<div class="stats-box">' + dailyBoardingsBHtml + '</div>' +
                '</div>' +
                '<div class="vs-badge">VS</div>' +
                '<div class="divider-line"></div>' +
                '<div class="annual-boardings-badge">' + dayName + ' Daily Boardings</div>' +
                (dailyComparisonText ? '<div class="comparison-badge">' + dailyComparisonText + '</div>' : '') +
                '</div>';

            document.getElementById('daily-boardings-display').innerHTML = html;
        }

        function updateHoursDisplay(a, b, hoursType) {
            currentHoursType = hoursType;
            
            // Get hours data for the selected type
            var hoursAHtml = '';
            var hoursBHtml = '';
            var hoursName = '';
            var hoursValueA = null;
            var hoursValueB = null;
            
            if (hoursType === 'revenue') {
                hoursName = 'Revenue';
            } else if (hoursType === 'service') {
                hoursName = 'Service';
            }
            
            // Check if line a has data
            if (hoursData && hoursData[a]) {
                var typeVal = hoursData[a][hoursType];
                if (typeVal !== undefined && typeVal !== null && !isNaN(typeVal)) {
                    hoursValueA = typeVal;
                    hoursAHtml = generateSquareIcons(hoursValueA) +
                        '<div style="margin-top: 12px; font-size: 34px; font-weight: 800; color: #fff;">' + formatNumber(hoursValueA) + '<br><span style="font-size:0.75em; font-weight:600;">Annual ' + hoursName + ' Hours</span></div>';
                } else {
                    hoursAHtml = 'No data available';
                }
            } else {
                hoursAHtml = 'No data available for line ' + a;
            }

            // Check if line b has data
            if (hoursData && hoursData[b]) {
                var typeVal = hoursData[b][hoursType];
                if (typeVal !== undefined && typeVal !== null && !isNaN(typeVal)) {
                    hoursValueB = typeVal;
                    hoursBHtml = generateSquareIcons(hoursValueB) +
                        '<div style="margin-top: 12px; font-size: 34px; font-weight: 800; color: #fff;">' + formatNumber(hoursValueB) + '<br><span style="font-size:0.75em; font-weight:600;">Annual ' + hoursName + ' Hours</span></div>';
                } else {
                    hoursBHtml = 'No data available';
                }
            } else {
                hoursBHtml = 'No data available for line ' + b;
            }

            // Build hours comparison text
            var hoursComparisonText = '';
            if (hoursValueA !== null && hoursValueB !== null) {
                var leftVal = Number(hoursValueA);
                var rightVal = Number(hoursValueB);
                if (leftVal === rightVal) {
                    hoursComparisonText = a + ' and ' + b + ' have equal ' + hoursName.toLowerCase() + ' hours';
                } else if (leftVal > rightVal) {
                    var ratio = leftVal / rightVal;
                    if (ratio > 2) {
                        hoursComparisonText = a + ' has ' + formatSig(ratio) + 'x more ' + hoursName.toLowerCase() + ' hours than ' + b;
                    } else {
                        var pct = (leftVal - rightVal) / rightVal * 100;
                        hoursComparisonText = a + ' has ' + formatSig(pct) + '% more ' + hoursName.toLowerCase() + '\nhours than ' + b;
                    }
                } else {
                    var pct = (rightVal - leftVal) / rightVal * 100;
                    hoursComparisonText = a + ' has ' + formatSig(pct) + '% less ' + hoursName.toLowerCase() + '\nhours than ' + b;
                }
            }

            var html = '<div class="half left">' + a +
                '<div class="stats-box">' + hoursAHtml + '</div>' +
                '</div>' +
                '<div class="half right">' + b +
                    '<div class="stats-box">' + hoursBHtml + '</div>' +
                '</div>' +
                '<div class="vs-badge">VS</div>' +
                '<div class="divider-line"></div>' +
                '<div class="annual-boardings-badge">Annual ' + hoursName + ' Hours</div>' +
                (hoursComparisonText ? '<div class="comparison-badge">' + hoursComparisonText + '</div>' : '') +
                '</div>';

            document.getElementById('hours-display').innerHTML = html;
        }

        // Swap button: swap selected values of the two dropdowns and re-run comparison
        document.getElementById('swapBtn').addEventListener('click', function () {
            const s1 = document.getElementById('line1');
            const s2 = document.getElementById('line2');
            if (!s1 || !s2) return;
            const v1 = s1.value;
            const v2 = s2.value;
            s1.value = v2;
            s2.value = v1;
            const compareBtn = document.getElementById('compareBtn');
            if (compareBtn) compareBtn.click();
        });
        // Daily boardings selector button group logic
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('daily-btn')) {
                document.querySelectorAll('.daily-btn').forEach(btn => btn.classList.remove('daily-btn-active'));
                e.target.classList.add('daily-btn-active');
                
                // Determine which day type was selected and update display
                let dayType = 'weekday';
                if (e.target.id === 'btn-daily-sat') {
                    dayType = 'saturday';
                } else if (e.target.id === 'btn-daily-sun') {
                    dayType = 'sunday';
                }
                
                // Update the display with the current stored lines
                updateDailyBoardingsDisplay(currentLineA, currentLineB, dayType);
            }
            
            // Hours selector button group logic
            if (e.target.classList.contains('hours-btn')) {
                document.querySelectorAll('.hours-btn').forEach(btn => btn.classList.remove('hours-btn-active'));
                e.target.classList.add('hours-btn-active');
                
                // Determine which hours type was selected and update display
                let hoursType = 'revenue';
                if (e.target.id === 'btn-hours-service') {
                    hoursType = 'service';
                }
                
                // Update the display with the current stored lines
                updateHoursDisplay(currentLineA, currentLineB, hoursType);
            }
        });
    </script>

    <a href="/" class="button-card back-button">
        &laquo; Back to Home / Upload Page
    </a>

</body>
</html>
